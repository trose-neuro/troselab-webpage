{% assign button = include %}
{% assign button = button | hash_default: site.data.types[include.type] %}
{% assign href = button.link | replace: "$LINK", button.link | strip %}
{% assign is_mailto = false %}
{% assign has_scheme = false %}
{% assign is_http_external = false %}
{% if href contains "mailto:" or href contains "tel:" or href contains "://" %}
  {% assign has_scheme = true %}
{% endif %}
{% if href contains "mailto:" %}
  {% assign is_mailto = true %}
{% endif %}
{% assign href_prefix = href | slice: 0, 4 %}
{% if has_scheme == false and href_prefix == "www." %}
  {% assign href = "https://" | append: href %}
  {% assign has_scheme = true %}
{% endif %}
{% if href contains "http://" or href contains "https://" %}
  {% assign is_http_external = true %}
{% endif %}

{% if button.link or button.icon or button.text %}
  {% assign email_target = href | remove_first: "mailto:" | split: "?" | first %}
  {% assign email_reversed = email_target | split: "" | reverse | join: "" %}
  <div class="button-wrapper">
    <a
      class="button"
      {% if is_mailto %}
        href="#"
        data-email-obfuscated="true"
        data-email-reversed="{{ email_reversed | xml_escape }}"
      {% elsif has_scheme %}
        href="{{ href }}"
      {% else %}
        href="{{ href | relative_url }}"
      {% endif %}
      {% if is_http_external %}
        target="_blank"
        rel="noopener noreferrer"
      {% endif %}
      {% if button.tooltip %}
        data-tooltip="{{ button.tooltip | xml_escape }}"
      {% endif %}
      data-style="{{ include.style }}"
      {% if include.flip %}
        data-flip
      {% endif %}
      aria-label="{{ button.tooltip | default: button.icon | default: "button" | regex_strip }}"
    >
      {% include icon.html icon=button.icon %}
      {% if button.text and button.text != "" %}
        <span>{{ button.text }}</span>
      {% endif %}
    </a>
  </div>
{% endif %}
