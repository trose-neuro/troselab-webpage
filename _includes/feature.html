<div
  class="feature"
  {% if include.flip %}
    data-flip
  {% endif %}
>
  {% assign feature_href = include.link | default: "" | strip %}
  {% assign feature_has_scheme = false %}
  {% assign feature_external = false %}
  {% if feature_href contains "mailto:" or feature_href contains "tel:" or feature_href contains "://" %}
    {% assign feature_has_scheme = true %}
  {% endif %}
  {% assign feature_prefix = feature_href | slice: 0, 4 %}
  {% if feature_has_scheme == false and feature_prefix == "www." %}
    {% assign feature_href = "https://" | append: feature_href %}
    {% assign feature_has_scheme = true %}
  {% endif %}
  {% if feature_href contains "http://" or feature_href contains "https://" %}
    {% assign feature_external = true %}
  {% endif %}
  {% if include.news_limit %}
    {% assign feature_news_tag = include.news_tag | default: "" | strip %}
    {% assign feature_news_posts = site.posts %}
    {% if feature_news_tag != "" %}
      {% assign feature_news_posts = site.posts | where_exp: "post", "post.tags contains feature_news_tag" %}
    {% endif %}
    <div class="feature-image feature-news" aria-label="Latest news items">
      <div class="feature-news-items">
        {% for post in feature_news_posts limit: include.news_limit %}
          <article class="feature-news-item">
            <a href="{{ post.url | relative_url | uri_escape }}" class="feature-news-link">
              {{ post.title }}
            </a>
            <div class="feature-news-meta">
              {% if feature_news_tag != "" and post.tags contains feature_news_tag %}
                <span class="feature-news-tag">{{ feature_news_tag }}</span>
              {% endif %}
              <time class="feature-news-date" datetime="{{ post.date | date_to_xmlschema }}">
                {{ post.date | date: "%d %b %Y" }}
              </time>
            </div>
          </article>
        {% else %}
          {% if feature_news_tag != "" %}
            <p class="feature-news-empty">No featured news items yet.</p>
          {% else %}
            <p class="feature-news-empty">No news items yet.</p>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  {% else %}
    <a
      {% if feature_href != "" %}
        {% if feature_has_scheme %}
          href="{{ feature_href }}"
        {% else %}
          href="{{ feature_href | relative_url | uri_escape }}"
        {% endif %}
        {% if feature_external %}
          target="_blank"
          rel="noopener noreferrer"
        {% endif %}
      {% endif %}
      class="feature-image"
      {% if include.image_fit or include.image_position %}
        style="
          {% if include.image_fit %}
            --feature-image-fit: {{ include.image_fit }};
          {% endif %}
          {% if include.image_position %}
            --feature-image-position: {{ include.image_position }};
          {% endif %}
        "
      {% endif %}
      aria-label="{{ include.title | default: "feature link" | regex_strip }}"
    >
      {% assign feature_sizes = "(max-width: 900px) calc(100vw - 48px), 42vw" %}
      {%
        include responsive-image.html
        image=include.image
        alt=include.title
        sizes=feature_sizes
        loading="lazy"
      %}
    </a>
  {% endif %}
  <div class="feature-text">
    {% if include.title %}
      <p class="feature-title">{{ include.title }}</p>
    {% endif %}
    {{ include.text | markdownify }}
  </div>
</div>
