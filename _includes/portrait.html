{% if include.lookup %}
  {% assign member = site.members 
    | where_exp: "member", "member.slug == include.lookup"
    | first
  %}
{% else %}
  {% assign member = include %}
{% endif %}

{% assign type = site.data.types[member.role] %}
{% assign show_image = true %}
{% if member.role == "alum" or member.role == "alumni" or member.group == "alumni" %}
  {% assign show_image = false %}
{% endif %}
{% assign image_src = member.image %}
{% if include.style == "profile" and member.image %}
  {% assign landscape_candidate = member.image | replace: "_portrait.", "_landscape." %}
  {% assign image_src = landscape_candidate | file_exists | default: member.image %}
{% endif %}
{% assign portrait_sizes = "(max-width: 640px) 46vw, 205px" %}
{% if include.style == "profile" %}
  {% assign portrait_sizes = "(max-width: 900px) calc(100vw - 56px), 380px" %}
{% elsif include.style == "tiny" %}
  {% assign portrait_sizes = "54px" %}
{% elsif include.style == "small" %}
  {% assign portrait_sizes = "(max-width: 640px) 42vw, 138px" %}
{% endif %}

<div class="portrait-wrapper">
  <a
    {% if page.slug != member.slug %}
      href="{{ member.url | relative_url | uri_escape }}"
    {% endif %}
    class="portrait"
    data-style="{{ include.style }}"
    data-no-image="{% if show_image %}false{% else %}true{% endif %}"
    aria-label="{{ member.name | default: "member link" | regex_strip }}"
  >
    {% if type and show_image %}
      {% include icon.html icon=type.icon %}
    {% endif %}

    {% if show_image %}
      {%
        include responsive-image.html
        image=image_src
        class="portrait-image"
        alt=member.name
        sizes=portrait_sizes
        loading="lazy"
        data_highres=image_src
      %}
    {% endif %}

    {% if member.name %}
      <span class="portrait-name">
        {{ member.name }}
      </span>
    {% endif %}

    {% if member.description or type %}
      <span class="portrait-description">
        {{ member.description | default: type.description }}
      </span>
    {% endif %}

    {% if member.affiliation %}
      <span class="portrait-affiliation">
        {{ member.affiliation }}
      </span>
    {% endif %}
  </a>
</div>
